# 发布信息接口需求分析

## 功能概述

发布信息页面是用户提交新的失物或招领信息的核心功能界面。用户可以选择信息类型（失物/招领），填写物品详细信息、地点、时间、联系方式，并上传图片。页面提供了表单验证、图片预览和提交状态反馈等功能。

## 前端功能与数据需求

### 核心功能
1. **信息类型选择**：区分失物信息和招领信息
2. **表单填写**：包含物品名称、分类、描述、丢失/拾得地点和时间
3. **联系方式填写**：联系人、电话、邮箱等
4. **图片上传**：支持多张图片上传和预览
5. **表单验证**：必填项检查、格式验证等
6. **提交反馈**：成功/失败提示

### 数据结构需求

发布信息的数据结构如下：

```javascript
{
  id: 'unique-id',         // 唯一标识符（后端生成）
  infoType: 'lost|found',  // 信息类型：失物或招领
  itemName: '物品名称',     // 物品名称
  itemCategory: '分类',     // 物品分类
  itemDescription: '描述',   // 物品描述
  location: 'location-code', // 地点代码
  locationDetail: '详细地点', // 详细地点描述
  datetime: 'ISO时间',      // 丢失/拾得时间
  contactName: '联系人',     // 联系人姓名
  contactPhone: '电话',      // 联系电话
  contactEmail: '邮箱',      // 联系邮箱
  images: ['url1', 'url2'],  // 图片URL数组
  status: 'pending|resolved', // 状态：待处理或已解决（默认pending）
  createdAt: 'ISO时间'       // 创建时间（后端生成）
}
```

## 接口需求

### 1. 发布新信息

**接口路径**：`POST /api/items`

**请求方式**：POST

**请求体**：multipart/form-data（支持文件上传）

**表单字段**：
- `infoType`: 'lost' 或 'found'
- `itemName`: 物品名称
- `itemCategory`: 物品分类
- `itemDescription`: 物品描述
- `location`: 地点代码
- `locationDetail`: 详细地点描述
- `datetime`: ISO格式的时间字符串
- `contactName`: 联系人姓名
- `contactPhone`: 联系电话
- `contactEmail`: 联系邮箱（可选）
- `images[]`: 图片文件数组（最多3张）

**请求头**：
- `Authorization`: `Bearer {token}` （如果需要登录）

**成功响应**：
```json
{
  "success": true,
  "data": {
    "id": "123456",
    "status": "pending",
    "createdAt": "2024-03-20T10:00:00Z",
    "updatedAt": "2024-03-20T10:00:00Z"
  }
}
```

**错误响应**：
```json
{
  "success": false,
  "error": {
    "code": 400,
    "message": "缺少必填字段：物品名称"
  }
}
```

### 2. 编辑已有信息

**接口路径**：`PUT /api/items/:id`

**请求方式**：PUT

**请求体**：multipart/form-data

**表单字段**：
- 与发布新信息相同，但可以只包含需要更新的字段
- 可选：`_removeImages`: 需要删除的图片ID数组

**请求头**：
- `Authorization`: `Bearer {token}`

**成功响应**：
```json
{
  "success": true,
  "data": {
    "id": "123456",
    "status": "pending",
    "createdAt": "2024-03-20T10:00:00Z",
    "updatedAt": "2024-03-20T11:00:00Z"
  }
}
```

### 3. 获取编辑信息

**接口路径**：`GET /api/items/:id/edit`

**请求方式**：GET

**请求头**：
- `Authorization`: `Bearer {token}`

**成功响应**：
```json
{
  "success": true,
  "data": {
    // 完整的物品信息对象，包含updatedAt字段
  }
}
```

## 数据库设计

### items表

| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|------|------|
| id | VARCHAR(36) | PRIMARY KEY | 唯一标识符（UUID） |
| user_id | VARCHAR(36) | NOT NULL | 用户ID（外键） |
| info_type | ENUM('lost', 'found') | NOT NULL | 信息类型 |
| item_name | VARCHAR(255) | NOT NULL | 物品名称 |
| item_category | VARCHAR(50) | NOT NULL | 物品分类 |
| item_description | TEXT | NOT NULL | 物品描述 |
| location | VARCHAR(50) | NOT NULL | 地点代码 |
| location_detail | TEXT | | 详细地点描述 |
| datetime | DATETIME | NOT NULL | 丢失/拾得时间 |
| contact_name | VARCHAR(100) | NOT NULL | 联系人姓名 |
| contact_phone | VARCHAR(20) | NOT NULL | 联系电话 |
| contact_email | VARCHAR(100) | | 联系邮箱 |
| status | ENUM('pending', 'resolved') | DEFAULT 'pending' | 状态 |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

### item_images表

| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|------|------|
| id | VARCHAR(36) | PRIMARY KEY | 唯一标识符 |
| item_id | VARCHAR(36) | NOT NULL | 物品ID（外键） |
| image_url | VARCHAR(255) | NOT NULL | 图片URL |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |

## 后端实现要点

1. **文件上传处理**：
   - 限制文件大小和类型
   - 重命名文件避免冲突
   - 存储到适当位置并生成URL

2. **数据验证**：
   - 验证必填字段
   - 验证电话号码格式
   - 验证邮箱格式
   - 验证时间格式

3. **权限控制**：
   - 确保用户只能编辑自己的发布
   - 处理认证和授权

4. **事务管理**：
   - 确保数据一致性
   - 处理图片上传失败的回滚

## 前端与后端对接说明

1. **配置统一**：
   - 使用`API_BASE_URL`常量统一API基础路径
   - 使用`LOCAL_STORAGE_KEY`常量统一本地存储键名

2. **数据格式转换**：
   - 前端使用FormData处理文件上传
   - 确保时间格式为ISO标准格式

3. **错误处理**：
   - 处理网络错误和服务器错误
   - 显示友好的错误提示

4. **认证信息**：
   - 在API请求中包含JWT token

## 统一配置与命名规范

为确保多页面间的一致性，统一使用以下配置：

1. **API基础URL**：`const API_BASE_URL = '/api';`
2. **本地存储键名**：`const LOCAL_STORAGE_KEY = 'publishedItems';`
3. **数据字段命名**：
   - 图片字段使用`images`而非`imagePreviews`
   - 统一使用驼峰命名法
4. **页面间跳转参数**：
   - 编辑模式：`失物招领平台_发布信息页面.html?id={id}&edit=true`