<!DOCTYPE html><html lang="zh-CN"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>个人中心 - 拾物通</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.iconify.design/3/3.1.1/iconify.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap');
        body {
            background-color: #f8fafc;
            font-family: 'Noto Sans SC', sans-serif;
            color: #334155;
        }
        .card {
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            transition: all 0.2s ease;
        }
        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
        }
        .btn-primary {
            background-color: #1e3a8a;
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            transition: background-color 0.2s;
        }
        .btn-primary:hover {
            background-color: #1d4ed8;
        }
        .btn-secondary {
            border: 1px solid #cbd5e1;
            padding: 8px 16px;
            border-radius: 6px;
            transition: background-color 0.2s;
        }
        .btn-secondary:hover {
            background-color: #f1f5f9;
        }
        .tag {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
        }
        .tag-found {
            background-color: #dcfce7;
            color: #166534;
        }
        .tag-lost {
            background-color: #ffedd5;
            color: #9a3412;
        }
        input:focus, textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }
        .nav-link {
            position: relative;
            padding-bottom: 5px;
        }
        .nav-link.active:after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: #ff7d00;
        }
        .sidebar-link {
            padding: 10px 16px;
            border-radius: 6px;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            margin-bottom: 4px;
        }
        .sidebar-link:hover {
            background-color: #f1f5f9;
        }
        .sidebar-link.active {
            background-color: #eef2ff;
            color: #1e3a8a;
            font-weight: 500;
        }
        .profile-stats {
            border-radius: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .avatar-upload {
            position: relative;
        }
        .avatar-upload .avatar-upload-icon {
            position: absolute;
            bottom: 0;
            right: 0;
            background-color: #1e3a8a;
            color: white;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .notification-badge {
            background-color: #ef4444;
            color: white;
            border-radius: 10px;
            padding: 1px 6px;
            font-size: 0.7rem;
            font-weight: 500;
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- 顶部导航栏 -->
    <header class="bg-white shadow-sm">
        <div class="container mx-auto px-6 py-4 max-w-7xl">
            <div class="flex items-center justify-between">
                <!-- Logo -->
                <div class="flex items-center space-x-2">
                    <span class="iconify text-2xl text-blue-800" data-icon="mdi:hand-heart"></span>
                    <h1 class="text-xl font-bold text-blue-800">拾物通</h1>
                </div>
                
                <!-- 主导航菜单 -->
                <nav class="hidden md:flex space-x-8">
                    <a href="失物招领平台_失物页面.html" class="nav-link font-medium text-gray-600 hover:text-blue-800">失物</a>
                    <a href="失物招领平台_招领页面.html" class="nav-link font-medium text-gray-600 hover:text-blue-800">招领</a>
                    <a href="失物招领平台_发布信息页面.html" class="nav-link font-medium text-gray-600 hover:text-blue-800">发布信息</a>
                    <a href="失物招领平台_私信页面.html" class="nav-link font-medium text-gray-600 hover:text-blue-800">私信</a>
                    <a href="失物招领平台_个人中心页面.html" class="nav-link active font-medium text-blue-800">个人中心</a>
                </nav>
                
                <!-- 搜索框 -->
                <div class="hidden lg:flex items-center border border-gray-300 rounded-lg px-3 py-2 w-64">
                    <input type="text" placeholder="搜索物品或地点..." class="flex-1 focus:ring-0 border-none">
                    <span class="iconify text-gray-500" data-icon="mdi:magnify"></span>
                </div>
                
                <!-- 用户入口 -->
                <div class="flex items-center space-x-4">
                    <div class="relative">
                        <button class="p-2 text-gray-600 hover:text-blue-800">
                            <span class="iconify text-xl" data-icon="mdi:bell"></span>
                            <span class="absolute top-0 right-0 notification-badge">3</span>
                        </button>
                    </div>
                    <div class="hidden lg:block">
                        <a href="index.html" class="btn-secondary text-sm">登录/注册</a>
                    </div>
                    <div class="lg:hidden">
                        <span class="iconify text-2xl text-gray-700" data-icon="mdi:menu"></span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- 主体内容 -->
    <main class="container mx-auto px-6 py-8 max-w-7xl">
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
            <!-- 左侧边栏 -->
            <div class="lg:col-span-1">
                <!-- 用户信息卡片 -->
                <div class="bg-white card p-6 mb-6">
                    <div class="avatar-upload flex flex-col items-center mb-4">
                        <img src="https://randomuser.me/api/portraits/women/44.jpg" alt="用户头像" class="w-24 h-24 rounded-full object-cover mb-2">
                        <div class="avatar-upload-icon">
                            <span class="iconify" data-icon="mdi:camera"></span>
                        </div>
                        <h2 class="font-bold text-lg">陈静</h2>
                        <p class="text-sm text-gray-500">普通用户</p>
                    </div>
                    
                    <!-- 个人统计 -->
                    <div class="profile-stats text-white p-4 mb-4">
                        <div class="grid grid-cols-3 gap-2 text-center">
                            <div>
                                <p class="text-2xl font-bold">12</p>
                                <p class="text-xs">发布</p>
                            </div>
                            <div>
                                <p class="text-2xl font-bold">5</p>
                                <p class="text-xs">找回</p>
                            </div>
                            <div>
                                <p class="text-2xl font-bold">24</p>
                                <p class="text-xs">收藏</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 侧边栏导航 -->
                <div class="bg-white card p-4">
                    <h3 class="font-bold text-lg mb-4">个人中心</h3>
                    <ul class="space-y-1">
                        <li><a href="失物招领平台_发布历史页面.html" class="sidebar-link" onclick="event.preventDefault(); window.location.href='失物招领平台_发布历史页面.html';"><span class="iconify mr-3" data-icon="mdi:clipboard-list"></span>发布历史</a></li>
                        <li><a href="失物招领平台_我的收藏页面.html" class="sidebar-link" onclick="event.preventDefault(); window.location.href='失物招领平台_我的收藏页面.html';"><span class="iconify mr-3" data-icon="mdi:heart"></span>我的收藏</a></li>
                        <li class="mt-6 pt-4 border-t border-gray-200">
                            <a href="index.html" class="sidebar-link text-red-600 hover:bg-red-50"><span class="iconify mr-3" data-icon="mdi:logout"></span>退出登录</a>
                        </li>
                    </ul>
                </div>
            </div>
            
            <!-- 右侧内容区 -->
            <div class="lg:col-span-3">
                <!-- 选项卡导航 -->
                <div class="bg-white card p-4 mb-6">
                    <div class="flex flex-wrap border-b">
                        <button class="tab-btn px-4 py-2 font-medium text-blue-800 border-b-2 border-blue-800" data-tab="basic-info">基本信息</button>
                        <button class="tab-btn px-4 py-2 font-medium text-gray-600" data-tab="contact-info">联系方式</button>
                        <button class="tab-btn px-4 py-2 font-medium text-gray-600" data-tab="privacy-settings">隐私设置</button>
                    </div>
                </div>
                
                <!-- 基本信息选项卡内容 -->
                <div id="basic-info" class="tab-content active bg-white card p-6 mb-6">
                    <h3 class="font-bold text-lg mb-6">基本信息</h3>
                    <form>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">用户名</label>
                                <input type="text" value="陈静" class="w-full px-4 py-2 border rounded-lg focus:ring-0">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">昵称</label>
                                <input type="text" value="静心如水" class="w-full px-4 py-2 border rounded-lg focus:ring-0">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">性别</label>
                                <div class="flex space-x-4 pt-2">
                                    <label class="flex items-center">
                                        <input type="radio" name="gender" value="female" checked class="mr-2">
                                        <span>女</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="radio" name="gender" value="male" class="mr-2">
                                        <span>男</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="radio" name="gender" value="other" class="mr-2">
                                        <span>保密</span>
                                    </label>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">生日</label>
                                <input type="date" value="1995-05-15" class="w-full px-4 py-2 border rounded-lg focus:ring-0">
                            </div>
                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium text-gray-700 mb-1">个人简介</label>
                                <textarea rows="4" class="w-full px-4 py-2 border rounded-lg focus:ring-0">热爱生活，乐于助人。希望通过这个平台帮助更多人找回失物，也感谢每一位拾金不昧的好心人。</textarea>
                            </div>
                        </div>
                        <div class="flex justify-end">
                            <button type="button" class="btn-secondary mr-3">取消</button>
                            <button type="submit" class="btn-primary">保存更改</button>
                        </div>
                    </form>
                </div>
                
                <!-- 联系方式选项卡内容 -->
                <div id="contact-info" class="tab-content bg-white card p-6 mb-6">
                    <h3 class="font-bold text-lg mb-6">联系方式</h3>
                    <form>
                        <div class="space-y-6 mb-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">手机号码</label>
                                <div class="flex">
                                    <input type="tel" value="138****5678" disabled class="w-full px-4 py-2 border rounded-l-lg focus:ring-0 bg-gray-100">
                                    <button type="button" class="btn-secondary rounded-r-lg border-l-0">修改</button>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">电子邮箱</label>
                                <div class="flex">
                                    <input type="email" value="chenj***@example.com" disabled class="w-full px-4 py-2 border rounded-l-lg focus:ring-0 bg-gray-100">
                                    <button type="button" class="btn-secondary rounded-r-lg border-l-0">修改</button>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">微信</label>
                                <input type="text" value="chen_jing2023" class="w-full px-4 py-2 border rounded-lg focus:ring-0">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">常用地址</label>
                                <textarea rows="3" class="w-full px-4 py-2 border rounded-lg focus:ring-0">北京市海淀区学院路38号北京大学学生公寓5号楼302室</textarea>
                            </div>
                        </div>
                        <div class="flex justify-end">
                            <button type="button" class="btn-secondary mr-3">取消</button>
                            <button type="submit" class="btn-primary">保存更改</button>
                        </div>
                    </form>
                </div>
                
                <!-- 隐私设置选项卡内容 -->
                <div id="privacy-settings" class="tab-content bg-white card p-6 mb-6">
                    <h3 class="font-bold text-lg mb-6">隐私设置</h3>
                    <form>
                        <div class="space-y-6 mb-6">
                            <div class="flex items-center justify-between p-4 border rounded-lg">
                                <div>
                                    <h4 class="font-medium">谁可以查看我的个人信息</h4>
                                    <p class="text-sm text-gray-500">控制其他用户是否可以看到您的基本资料</p>
                                </div>
                                <select class="border rounded-lg px-3 py-1 focus:ring-0">
                                    <option>仅自己可见</option>
                                    <option>已认证用户可见</option>
                                    <option>所有人可见</option>
                                </select>
                            </div>
                            
                            <div class="flex items-center justify-between p-4 border rounded-lg">
                                <div>
                                    <h4 class="font-medium">谁可以给我发送私信</h4>
                                    <p class="text-sm text-gray-500">控制哪些用户可以与您私信联系</p>
                                </div>
                                <select class="border rounded-lg px-3 py-1 focus:ring-0">
                                    <option>所有人</option>
                                    <option>仅已认证用户</option>
                                    <option>仅关注的用户</option>
                                </select>
                            </div>
                            
                            <div class="flex items-center justify-between p-4 border rounded-lg">
                                <div>
                                    <h4 class="font-medium">消息通知设置</h4>
                                    <p class="text-sm text-gray-500">控制哪些类型的消息可以通知到您</p>
                                </div>
                                <button type="button" class="text-blue-800">设置</button>
                            </div>
                            
                            <div class="space-y-4">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h4 class="font-medium">允许搜索我的发布记录</h4>
                                        <p class="text-sm text-gray-500">允许其他用户通过搜索找到您发布的信息</p>
                                    </div>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" value="" class="sr-only peer" checked>
                                        <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-800"></div>
                                    </label>
                                </div>
                                
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h4 class="font-medium">发布信息时默认匿名</h4>
                                        <p class="text-sm text-gray-500">设置后，您发布的所有信息将默认以匿名形式展示</p>
                                    </div>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" value="" class="sr-only peer">
                                        <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-800"></div>
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="flex justify-end">
                            <button type="button" class="btn-secondary mr-3">取消</button>
                            <button type="submit" class="btn-primary">保存设置</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </main>

    <!-- 页脚区域 -->
    <footer class="bg-gray-100 py-10 mt-8">
        <div class="container mx-auto px-6 max-w-7xl">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <div class="flex items-center space-x-2 mb-4">
                        <span class="iconify text-2xl text-blue-800" data-icon="mdi:hand-heart"></span>
                        <h2 class="text-xl font-bold text-blue-800">拾物通</h2>
                    </div>
                    <p class="text-gray-600 mb-4">连接失物与主人的公益平台</p>
                    <div class="flex space-x-4">
                        <a href="#" class="text-gray-600 hover:text-blue-800">
                            <span class="iconify text-xl" data-icon="mdi:wechat"></span>
                        </a>
                        <a href="#" class="text-gray-600 hover:text-blue-800">
                            <span class="iconify text-xl" data-icon="mdi:weibo"></span>
                        </a>
                        <a href="#" class="text-gray-600 hover:text-blue-800">
                            <span class="iconify text-xl" data-icon="mdi:qqchat"></span>
                        </a>
                    </div>
                </div>
                
                <div>
                    <h3 class="font-bold text-lg mb-4">快速链接</h3>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-600 hover:text-blue-800">关于我们</a></li>
                        <li><a href="#" class="text-gray-600 hover:text-blue-800">失物认领流程</a></li>
                        <li><a href="#" class="text-gray-600 hover:text-blue-800">招领物品指南</a></li>
                        <li><a href="#" class="text-gray-600 hover:text-blue-800">联系我们</a></li>
                    </ul>
                </div>
                
                <div>
                    <h3 class="font-bold text-lg mb-4">帮助中心</h3>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-600 hover:text-blue-800">常见问题</a></li>
                        <li><a href="#" class="text-gray-600 hover:text-blue-800">用户协议</a></li>
                        <li><a href="#" class="text-gray-600 hover:text-blue-800">隐私政策</a></li>
                        <li><a href="#" class="text-gray-600 hover:text-blue-800">使用指南</a></li>
                    </ul>
                </div>
                

            </div>
            
            <div class="border-t border-gray-200 mt-8 pt-6 text-center text-gray-500 text-sm">
                <p>© 2025 拾物通 失物招领平台 版权所有 京ICP备12345678号</p>
            </div>
        </div>
    </footer>

    <!-- 个人中心页面数据处理逻辑 -->
    <script>
        // 配置：是否使用本地存储模式
        const USE_LOCAL_STORAGE = true; // 设置为true使用本地存储，设置为false使用后端API
        const API_BASE_URL = '/api'; // 统一的后端API基础URL
        
        // 模拟用户ID
        const CURRENT_USER_ID = 'user1';
        const USER_DATA_KEY = `user_${CURRENT_USER_ID}`; // 用户数据存储键
        
        // 加载用户数据
        async function loadUserData() {
            try {
                let userData;
                
                if (USE_LOCAL_STORAGE) {
                    userData = loadUserDataFromLocalStorage();
                } else {
                    userData = await loadUserDataFromAPI();
                }
                
                // 更新页面上的用户信息
                updateUserProfileUI(userData);
                
                return userData;
            } catch (error) {
                console.error('加载用户数据失败:', error);
                alert('加载用户数据失败，请稍后重试');
                return null;
            }
        }
        
        // 从本地存储加载用户数据
        function loadUserDataFromLocalStorage() {
            // 尝试从本地存储获取数据
            const storedData = localStorage.getItem(USER_DATA_KEY);
            
            // 如果没有数据，返回默认值
            if (!storedData) {
                return getDefaultUserData();
            }
            
            return JSON.parse(storedData);
        }
        
        // 从API加载用户数据
        async function loadUserDataFromAPI() {
            try {
                const response = await fetch(`${API_BASE_URL}/users/${CURRENT_USER_ID}`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                        // 实际应用中这里应该包含认证token
                        // 'Authorization': `Bearer ${getToken()}`
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`API请求失败: ${response.status}`);
                }
                
                return await response.json();
            } catch (error) {
                console.error('API请求失败:', error);
                // 如果API请求失败，使用默认数据
                return getDefaultUserData();
            }
        }
        
        // 获取默认用户数据
        function getDefaultUserData() {
            return {
                id: CURRENT_USER_ID,
                username: '陈静',
                nickname: '静心如水',
                gender: 'female',
                birthday: '1995-05-15',
                bio: '热爱生活，乐于助人。希望通过这个平台帮助更多人找回失物，也感谢每一位拾金不昧的好心人。',
                phone: '138****5678',
                email: 'chenj***@example.com',
                wechat: 'chen_jing2023',
                address: '北京市海淀区学院路38号北京大学学生公寓5号楼302室',
                avatar: 'https://randomuser.me/api/portraits/women/44.jpg',
                role: '普通用户',
                stats: {
                    posts: 12,
                    recovered: 5,
                    favorites: 24
                },
                privacySettings: {
                    profileVisibility: '仅自己可见',
                    messagePermission: '所有人',
                    searchablePosts: true,
                    defaultAnonymous: false
                }
            };
        }
        
        // 更新用户界面
        function updateUserProfileUI(userData) {
            // 更新用户基本信息
            document.querySelector('.avatar-upload img').src = userData.avatar;
            document.querySelector('.avatar-upload h2').textContent = userData.username;
            document.querySelector('.avatar-upload p').textContent = userData.role;
            
            // 更新统计数据
            const stats = document.querySelectorAll('.profile-stats .text-2xl');
            stats[0].textContent = userData.stats.posts;
            stats[1].textContent = userData.stats.recovered;
            stats[2].textContent = userData.stats.favorites;
            
            // 更新基本信息表单
            const basicInfoForm = document.querySelector('#basic-info form');
            basicInfoForm.querySelector('input[value="陈静"]').value = userData.username;
            basicInfoForm.querySelector('input[type="text"]:nth-of-type(2)').value = userData.nickname;
            basicInfoForm.querySelector(`input[name="gender"][value="${userData.gender}"]`).checked = true;
            basicInfoForm.querySelector('input[type="date"]').value = userData.birthday;
            basicInfoForm.querySelector('textarea').value = userData.bio;
            
            // 更新联系方式表单
            const contactInfoForm = document.querySelector('#contact-info form');
            contactInfoForm.querySelector('input[type="tel"]').value = userData.phone;
            contactInfoForm.querySelector('input[type="email"]').value = userData.email;
            contactInfoForm.querySelector('input[value="chen_jing2023"]').value = userData.wechat;
            contactInfoForm.querySelector('textarea').value = userData.address;
            
            // 更新隐私设置表单
            const privacyForm = document.querySelector('#privacy-settings form');
            privacyForm.querySelector('select:nth-of-type(1)').value = userData.privacySettings.profileVisibility;
            privacyForm.querySelector('select:nth-of-type(2)').value = userData.privacySettings.messagePermission;
            privacyForm.querySelector('input[type="checkbox"]:nth-of-type(1)').checked = userData.privacySettings.searchablePosts;
            privacyForm.querySelector('input[type="checkbox"]:nth-of-type(2)').checked = userData.privacySettings.defaultAnonymous;
        }
        
        // 保存用户数据
        async function saveUserData(section, data) {
            try {
                if (USE_LOCAL_STORAGE) {
                    saveUserDataToLocalStorage(section, data);
                } else {
                    await saveUserDataToAPI(section, data);
                }
                
                // 刷新页面上的用户数据
                await loadUserData();
                
                return true;
            } catch (error) {
                console.error('保存用户数据失败:', error);
                alert('保存失败，请稍后重试');
                return false;
            }
        }
        
        // 保存到本地存储
        function saveUserDataToLocalStorage(section, data) {
            const currentData = loadUserDataFromLocalStorage();
            
            // 根据部分更新数据
            switch(section) {
                case 'basic-info':
                    currentData.username = data.username;
                    currentData.nickname = data.nickname;
                    currentData.gender = data.gender;
                    currentData.birthday = data.birthday;
                    currentData.bio = data.bio;
                    break;
                case 'contact-info':
                    currentData.phone = data.phone || currentData.phone;
                    currentData.email = data.email || currentData.email;
                    currentData.wechat = data.wechat || currentData.wechat;
                    currentData.address = data.address || currentData.address;
                    break;
                case 'privacy-settings':
                    currentData.privacySettings = {
                        ...currentData.privacySettings,
                        ...data
                    };
                    break;
            }
            
            // 保存到本地存储
            localStorage.setItem(USER_DATA_KEY, JSON.stringify(currentData));
            console.log('用户数据已保存到本地存储:', currentData);
            alert('设置已保存！');
        }
        
        // 保存到API
        async function saveUserDataToAPI(section, data) {
            try {
                const response = await fetch(`${API_BASE_URL}/users/${CURRENT_USER_ID}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                        // 'Authorization': `Bearer ${getToken()}`
                    },
                    body: JSON.stringify({
                        section: section,
                        data: data
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`API请求失败: ${response.status}`);
                }
                
                alert('设置已保存！');
            } catch (error) {
                console.error('API保存失败:', error);
                throw error;
            }
        }
        
        // 头像上传功能
        function handleAvatarUpload() {
            const uploadIcon = document.querySelector('.avatar-upload-icon');
            
            uploadIcon.addEventListener('click', function() {
                // 创建隐藏的文件输入
                const fileInput = document.createElement('input');
                fileInput.type = 'file';
                fileInput.accept = 'image/*';
                fileInput.style.display = 'none';
                document.body.appendChild(fileInput);
                
                // 监听文件选择
                fileInput.addEventListener('change', async function(e) {
                    if (e.target.files && e.target.files[0]) {
                        const file = e.target.files[0];
                        
                        // 预览图片
                        const reader = new FileReader();
                        reader.onload = function(event) {
                            document.querySelector('.avatar-upload img').src = event.target.result;
                        };
                        reader.readAsDataURL(file);
                        
                        // 上传图片
                        if (USE_LOCAL_STORAGE) {
                            // 本地存储模式：只更新本地预览
                            const currentData = loadUserDataFromLocalStorage();
                            currentData.avatar = URL.createObjectURL(file);
                            localStorage.setItem(USER_DATA_KEY, JSON.stringify(currentData)); // 使用统一的存储键名
                            alert('头像已更新！');
                        } else {
                            // API模式：上传到服务器
                            const formData = new FormData();
                            formData.append('avatar', file);
                            
                            try {
                                const response = await fetch(`/api/users/${CURRENT_USER_ID}/avatar`, {
                                    method: 'POST',
                                    // 'Authorization': `Bearer ${getToken()}`,
                                    body: formData
                                });
                                
                                if (!response.ok) {
                                    throw new Error(`上传头像失败: ${response.status}`);
                                }
                                
                                const result = await response.json();
                                // 更新头像URL
                                document.querySelector('.avatar-upload img').src = result.avatarUrl;
                                alert('头像已更新！');
                            } catch (error) {
                                console.error('上传头像失败:', error);
                                alert('上传头像失败，请稍后重试');
                            }
                        }
                    }
                    
                    // 移除临时文件输入
                    document.body.removeChild(fileInput);
                });
                
                // 触发文件选择对话框
                fileInput.click();
            });
        }
        
        // 手机号码修改功能
        function setupPhoneEdit() {
            const phoneEditBtn = document.querySelector('#contact-info button:first-of-type');
            const phoneInput = document.querySelector('#contact-info input[type="tel"]');
            
            phoneEditBtn.addEventListener('click', function() {
                // 移除禁用状态和灰色背景
                phoneInput.disabled = false;
                phoneInput.classList.remove('bg-gray-100');
                
                // 修改按钮文本为保存
                phoneEditBtn.textContent = '保存';
                
                // 保存新的手机号码
                phoneEditBtn.onclick = async function() {
                    const newPhone = phoneInput.value;
                    
                    // 简单的手机号验证
                    if (!/^1[3-9]\d{9}$/.test(newPhone)) {
                        alert('请输入有效的手机号码');
                        return;
                    }
                    
                    // 保存修改
                    await saveUserData('contact-info', {
                        phone: newPhone
                    });
                    
                    // 恢复禁用状态
                    phoneInput.disabled = true;
                    phoneInput.classList.add('bg-gray-100');
                    phoneEditBtn.textContent = '修改';
                    setupPhoneEdit(); // 重置事件
                };
            });
        }
        
        // 电子邮箱修改功能
        function setupEmailEdit() {
            const emailEditBtn = document.querySelector('#contact-info button:nth-of-type(2)');
            const emailInput = document.querySelector('#contact-info input[type="email"]');
            
            emailEditBtn.addEventListener('click', function() {
                // 移除禁用状态和灰色背景
                emailInput.disabled = false;
                emailInput.classList.remove('bg-gray-100');
                
                // 修改按钮文本为保存
                emailEditBtn.textContent = '保存';
                
                // 保存新的电子邮箱
                emailEditBtn.onclick = async function() {
                    const newEmail = emailInput.value;
                    
                    // 简单的邮箱验证
                    if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(newEmail)) {
                        alert('请输入有效的电子邮箱');
                        return;
                    }
                    
                    // 保存修改
                    await saveUserData('contact-info', {
                        email: newEmail
                    });
                    
                    // 恢复禁用状态
                    emailInput.disabled = true;
                    emailInput.classList.add('bg-gray-100');
                    emailEditBtn.textContent = '修改';
                    setupEmailEdit(); // 重置事件
                };
            });
        }
        
        // 初始化页面
        async function init() {
            // 加载用户数据
            await loadUserData();
            
            // 设置选项卡切换
            setupTabSwitching();
            
            // 设置侧边栏导航
            setupSidebarNavigation();
            
            // 设置表单提交
            setupFormSubmissions();
            
            // 设置头像上传
            handleAvatarUpload();
            
            // 设置手机号码修改
            setupPhoneEdit();
            
            // 设置电子邮箱修改
            setupEmailEdit();
        }
        
        // 设置选项卡切换
        function setupTabSwitching() {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    // 移除所有选项卡按钮的活跃状态
                    document.querySelectorAll('.tab-btn').forEach(b => {
                        b.classList.remove('text-blue-800', 'border-b-2', 'border-blue-800');
                        b.classList.add('text-gray-600');
                    });
                    
                    // 添加当前选项卡按钮的活跃状态
                    this.classList.remove('text-gray-600');
                    this.classList.add('text-blue-800', 'border-b-2', 'border-blue-800');
                    
                    // 隐藏所有选项卡内容
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    // 显示对应的选项卡内容
                    const tabId = this.getAttribute('data-tab');
                    document.getElementById(tabId).classList.add('active');
                });
            });
        }
        
        // 设置侧边栏导航
        function setupSidebarNavigation() {
            document.querySelectorAll('.sidebar-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    // 如果不是退出登录按钮，则应用活跃状态并跳转
                    if (!this.textContent.includes('退出登录')) {
                        e.preventDefault();
                        // 移除所有链接的活跃状态
                        document.querySelectorAll('.sidebar-link').forEach(l => {
                            l.classList.remove('active');
                        });
                        
                        // 添加当前链接的活跃状态
                        this.classList.add('active');
                        
                        // 导航到目标页面
                        window.location.href = this.getAttribute('href');
                    }
                });
            });
        }
        
        // 设置表单提交
        function setupFormSubmissions() {
            // 基本信息表单
            document.querySelector('#basic-info form').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const formData = {
                    username: this.querySelector('input[value="陈静"]').value,
                    nickname: this.querySelector('input[type="text"]:nth-of-type(2)').value,
                    gender: this.querySelector('input[name="gender"]:checked').value,
                    birthday: this.querySelector('input[type="date"]').value,
                    bio: this.querySelector('textarea').value
                };
                
                await saveUserData('basic-info', formData);
            });
            
            // 联系方式表单
            document.querySelector('#contact-info form').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const formData = {
                    wechat: this.querySelector('input[value="chen_jing2023"]').value,
                    address: this.querySelector('textarea').value
                };
                
                await saveUserData('contact-info', formData);
            });
            
            // 隐私设置表单
            document.querySelector('#privacy-settings form').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const formData = {
                    profileVisibility: this.querySelector('select:nth-of-type(1)').value,
                    messagePermission: this.querySelector('select:nth-of-type(2)').value,
                    searchablePosts: this.querySelector('input[type="checkbox"]:nth-of-type(1)').checked,
                    defaultAnonymous: this.querySelector('input[type="checkbox"]:nth-of-type(2)').checked
                };
                
                await saveUserData('privacy-settings', formData);
            });
        }
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', init);
    </script>

</body></html>