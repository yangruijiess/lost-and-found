# 发布历史接口需求分析

## 功能概述

发布历史页面是用户查看和管理其已发布的失物/招领信息的中心。用户可以查看所有历史发布、按类型筛选（失物/招领）、按状态筛选（已解决/待处理），并可以分页浏览、查看详情或编辑每条记录。

## 前端功能与数据需求

### 核心功能
1. **显示发布历史列表**：以卡片形式展示每条发布记录，包含基本信息、状态和操作按钮
2. **筛选功能**：
   - 按信息类型筛选：全部、失物信息、招领信息
   - 按状态筛选：已解决、待处理
3. **分页功能**：支持多页浏览，每页显示指定数量的记录
4. **操作功能**：查看详情、编辑记录

### 数据结构需求

单条发布历史记录的数据结构如下：

```javascript
{
  id: 'unique-id',         // 唯一标识符
  infoType: 'lost|found',  // 信息类型：失物或招领
  itemName: '物品名称',     // 物品名称
  itemCategory: '分类',     // 物品分类
  itemDescription: '描述',   // 物品描述
  location: 'location-code', // 地点代码
  locationDetail: '详细地点', // 详细地点描述
  datetime: 'ISO时间',      // 丢失/拾得时间
  contactName: '联系人',     // 联系人姓名
  contactPhone: '电话',      // 联系电话
  contactEmail: '邮箱',      // 联系邮箱
  images: ['url1', 'url2'],  // 图片URL数组
  status: 'pending|resolved', // 状态：待处理或已解决
  createdAt: 'ISO时间'       // 创建时间
}
```

### 前端状态管理

前端需要维护以下状态：
- 当前筛选条件
- 当前页码
- 每页显示数量
- 全部记录数据

## 接口需求

### 1. 获取用户发布历史列表

**接口路径**：`GET /api/user/items`

**请求参数**：
- `page`：当前页码（可选，默认1）
- `limit`：每页数量（可选，默认10）
- `type`：筛选类型（可选，值为'lost'或'found'）
- `status`：筛选状态（可选，值为'pending'或'resolved'）

**请求头**：
- `Authorization`: `Bearer {token}`
- `Content-Type`: `application/json`

**成功响应**：
```json
{
  "success": true,
  "data": {
    "items": [
      // 发布历史记录数组
    ],
    "total": 100,
    "page": 1,
    "limit": 10
  }
}
```

### 2. 获取单条发布记录详情

**接口路径**：`GET /api/user/items/:id`

**请求头**：
- `Authorization`: `Bearer {token}`
- `Content-Type`: `application/json`

**成功响应**：
```json
{
  "success": true,
  "data": {
    // 单条发布历史记录
  }
}
```

### 3. 更新发布记录

**接口路径**：`PUT /api/user/items/:id`

**请求体**：
```json
{
  "itemName": "更新的物品名称",
  "itemDescription": "更新的描述",
  "status": "resolved", // 可更新状态
  // 其他需要更新的字段
}
```

**请求头**：
- `Authorization`: `Bearer {token}`
- `Content-Type`: `application/json`

**成功响应**：
```json
{
  "success": true,
  "data": {
    // 更新后的完整记录
  }
}
```

### 4. 删除发布记录

**接口路径**：`DELETE /api/user/items/:id`

**请求头**：
- `Authorization`: `Bearer {token}`
- `Content-Type`: `application/json`

**成功响应**：
```json
{
  "success": true,
  "message": "记录已成功删除"
}
```

## 数据库设计

为支持发布历史功能，需要以下数据表：

### items表

| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|------|------|
| id | VARCHAR(36) | PRIMARY KEY | 唯一标识符 |
| user_id | VARCHAR(36) | NOT NULL | 用户ID（外键） |
| info_type | ENUM('lost', 'found') | NOT NULL | 信息类型 |
| item_name | VARCHAR(255) | NOT NULL | 物品名称 |
| item_category | VARCHAR(50) | NOT NULL | 物品分类 |
| item_description | TEXT | NOT NULL | 物品描述 |
| location | VARCHAR(50) | NOT NULL | 地点代码 |
| location_detail | TEXT | | 详细地点描述 |
| datetime | DATETIME | NOT NULL | 丢失/拾得时间 |
| contact_name | VARCHAR(100) | NOT NULL | 联系人姓名 |
| contact_phone | VARCHAR(20) | NOT NULL | 联系电话 |
| contact_email | VARCHAR(100) | | 联系邮箱 |
| status | ENUM('pending', 'resolved') | DEFAULT 'pending' | 状态 |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

### item_images表

| 字段名 | 数据类型 | 约束 | 描述 |
|-------|---------|------|------|
| id | VARCHAR(36) | PRIMARY KEY | 唯一标识符 |
| item_id | VARCHAR(36) | NOT NULL | 物品ID（外键） |
| image_url | VARCHAR(255) | NOT NULL | 图片URL |
| created_at | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |

## 后端实现要点

1. **查询优化**：使用索引优化大数量级的查询性能
2. **权限控制**：确保用户只能访问和修改自己的发布记录
3. **数据验证**：对输入数据进行格式和内容验证
4. **分页处理**：支持高效的分页查询
5. **错误处理**：提供友好的错误提示和日志记录

## 前端与后端对接说明

1. **接口调用封装**：前端应封装API调用函数，统一处理请求和响应
2. **数据转换**：将后端返回的数据格式化为前端展示所需的格式
3. **错误处理**：捕获并处理API调用中的错误，显示适当的用户提示
4. **认证管理**：维护用户认证状态，在API请求中包含认证信息

## 扩展功能建议

1. **搜索功能**：支持按关键词搜索历史记录
2. **排序功能**：支持按时间、状态等字段排序
3. **导出功能**：支持将历史记录导出为CSV或PDF格式
4. **批量操作**：支持批量删除或状态更新
5. **数据统计**：提供发布历史数据的统计图表

## 统一配置与命名规范

为确保多页面间的一致性，统一使用以下配置：

1. **API基础URL**：`const API_BASE_URL = '/api';`
2. **本地存储键名**：`const LOCAL_STORAGE_KEY = 'publishedItems';`
3. **数据字段命名**：使用驼峰命名法
4. **页面间跳转参数**：
   - 编辑页面：`失物招领平台_发布信息页面.html?id={id}&edit=true`
   - 详情页面：`失物招领平台_详情页面.html?id={id}`