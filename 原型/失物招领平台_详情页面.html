<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>详情页面 - 拾物通</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.iconify.design/3/3.1.1/iconify.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap');
        body {
            background-color: #f8fafc;
            font-family: 'Noto Sans SC', sans-serif;
            color: #334155;
        }
        .card {
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            transition: all 0.2s ease;
        }
        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
        }
        .btn-primary {
            background-color: #1e3a8a;
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            transition: background-color 0.2s;
        }
        .btn-primary:hover {
            background-color: #1d4ed8;
        }
        .btn-secondary {
            border: 1px solid #cbd5e1;
            padding: 8px 16px;
            border-radius: 6px;
            transition: background-color 0.2s;
        }
        .btn-secondary:hover {
            background-color: #f1f5f9;
        }
        .tag {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
        }
        .tag-found {
            background-color: #dcfce7;
            color: #166534;
        }
        .tag-lost {
            background-color: #ffedd5;
            color: #9a3412;
        }
        .nav-link {
            position: relative;
            padding-bottom: 5px;
        }
        .nav-link.active:after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: #ff7d00;
        }
        .image-gallery {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }
        .image-gallery img {
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .image-gallery img:hover {
            transform: scale(1.05);
        }
        .detail-item {
            display: flex;
            margin-bottom: 1rem;
            align-items: flex-start;
        }
        .detail-item-label {
            min-width: 80px;
            color: #64748b;
            font-weight: 500;
        }
        .detail-item-value {
            flex: 1;
        }
        .contact-method {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        .contact-method span {
            margin-left: 0.5rem;
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- 顶部导航栏 -->
    <header class="bg-white shadow-sm">
        <div class="container mx-auto px-6 py-4 max-w-7xl">
            <div class="flex items-center justify-between">
                <!-- Logo -->
                <div class="flex items-center space-x-2">
                    <span class="iconify text-2xl text-blue-800" data-icon="mdi:hand-heart"></span>
                    <h1 class="text-xl font-bold text-blue-800">拾物通</h1>
                </div>
                
                <!-- 主导航菜单 -->
                <nav class="hidden md:flex space-x-8">
                    <a href="失物招领平台_失物页面.html" class="nav-link font-medium text-gray-600 hover:text-blue-800">失物</a>
                    <a href="失物招领平台_招领页面.html" class="nav-link font-medium text-gray-600 hover:text-blue-800">招领</a>
                    <a href="失物招领平台_发布信息页面.html" class="nav-link font-medium text-gray-600 hover:text-blue-800">发布信息</a>
                    <a href="失物招领平台_私信页面.html" class="nav-link font-medium text-gray-600 hover:text-blue-800">私信</a>
                    <a href="失物招领平台_个人中心页面.html" class="nav-link font-medium text-gray-600 hover:text-blue-800">个人中心</a>
                </nav>
                
                <!-- 搜索框 -->
                <div class="hidden lg:flex items-center border border-gray-300 rounded-lg px-3 py-2 w-64">
                    <input type="text" placeholder="搜索物品或地点..." class="flex-1 focus:ring-0 border-none">
                    <span class="iconify text-gray-500" data-icon="mdi:magnify"></span>
                </div>
                
                <!-- 用户入口 -->
                <div class="flex items-center space-x-4">
                    <a href="index.html" class="btn-secondary text-sm hidden lg:block">登录/注册</a>
                    <div class="lg:hidden">
                        <span class="iconify text-2xl text-gray-700" data-icon="mdi:menu"></span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- 主体内容 -->
    <main class="container mx-auto px-6 py-8 max-w-7xl">
        <!-- 返回按钮 -->
        <div class="mb-6">
            <button id="backButton" class="btn-secondary flex items-center">
                <span class="iconify mr-2" data-icon="mdi:arrow-left"></span>
                返回列表
            </button>
        </div>

        <!-- 物品详情卡片 -->
        <div class="bg-white card p-6 mb-6">
            <div class="flex flex-col md:flex-row gap-6">
                <!-- 左侧图片区域 -->
                <div class="md:w-1/2">
                    <div class="relative">
                        <img id="mainImage" src="https://modao.cc/ai/uploads/ai_pics/30/302277/aigp_1758618096.jpeg" alt="银色笔记本电脑" class="w-full h-80 object-cover rounded-lg">
                        <div id="itemTag" class="absolute top-4 right-4">
                            <span class="tag tag-lost">寻找中</span>
                        </div>
                    </div>
                    <div class="image-gallery mt-4 overflow-x-auto pb-2">
                        <img src="https://modao.cc/ai/uploads/ai_pics/30/302277/aigp_1758618096.jpeg" alt="银色笔记本电脑" class="h-20 object-cover cursor-pointer border-2 border-blue-800">
                        <img src="https://modao.cc/ai/uploads/ai_pics/30/302277/aigp_1758618097.jpeg" alt="笔记本电脑侧面" class="h-20 object-cover cursor-pointer">
                        <img src="https://modao.cc/ai/uploads/ai_pics/30/302277/aigp_1758618098.jpeg" alt="笔记本电脑键盘" class="h-20 object-cover cursor-pointer">
                    </div>
                </div>

                <!-- 右侧信息区域 -->
                <div class="md:w-1/2">
                    <div class="flex items-center justify-between mb-4">
                        <h2 id="itemTitle" class="text-2xl font-bold">银色笔记本电脑</h2>
                        <span id="publishDate" class="text-gray-500">发布于：2024-01-15</span>
                    </div>
                    
                    <div class="mb-6">
                        <h3 class="font-medium text-lg mb-2">物品描述</h3>
                        <p id="itemDescription" class="text-gray-600 leading-relaxed">
                            在图书馆3楼自习室丢失，联想小新系列，银色外壳，有轻微划痕。电脑贴有星空贴纸，
                            内有重要的学习资料和毕业论文。请捡到的同学联系我，必有重谢！
                        </p>
                    </div>

                    <div class="space-y-4">
                        <div class="detail-item">
                            <div class="detail-item-label">物品分类：</div>
                            <div id="itemCategory" class="detail-item-value">电子设备</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-item-label">丢失地点：</div>
                            <div id="itemLocation" class="detail-item-value">图书馆3楼自习室A区靠窗座位</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-item-label">丢失时间：</div>
                            <div id="itemTime" class="detail-item-value">2024-01-15 14:30-16:00</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-item-label">物品特征：</div>
                            <div id="itemFeatures" class="detail-item-value">
                                <ul class="list-disc pl-5">
                                    <li>银色联想小新系列笔记本电脑</li>
                                    <li>外壳有轻微划痕</li>
                                    <li>贴有星空贴纸</li>
                                    <li>电脑包为黑色双肩包</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 发布者信息 -->
        <div class="bg-white card p-6 mb-6">
            <h2 class="text-xl font-bold mb-4">发布者信息</h2>
            <div class="flex items-center space-x-4">
                <div class="w-16 h-16 rounded-full bg-blue-100 flex items-center justify-center">
                    <span class="iconify text-3xl text-blue-800" data-icon="mdi:account-circle"></span>
                </div>
                <div>
                    <h3 id="publisherName" class="font-medium text-lg">李同学</h3>
                    <p class="text-gray-500">经济学院 · 2022级</p>
                </div>
                <button id="contactPublisher" class="ml-auto btn-primary">
                    <span class="iconify mr-2" data-icon="mdi:message"></span>
                    联系发布者
                </button>
            </div>
        </div>




    </main>

    <!-- 页脚区域 -->
    <footer class="bg-gray-100 py-10 mt-12">
        <div class="container mx-auto px-6 max-w-7xl">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <div class="flex items-center space-x-2 mb-4">
                        <span class="iconify text-2xl text-blue-800" data-icon="mdi:hand-heart"></span>
                        <h2 class="text-xl font-bold text-blue-800">拾物通</h2>
                    </div>
                    <p class="text-gray-600 text-sm mb-4">
                        拾物通是一个致力于帮助失主找回失物、拾主归还物品的公益平台，
                        让每一件遗失的物品都能找到回家的路。
                    </p>
                    <div class="flex space-x-4">
                        <a href="#" class="text-gray-500 hover:text-blue-800">
                            <span class="iconify text-xl" data-icon="mdi:wechat"></span>
                        </a>
                        <a href="#" class="text-gray-500 hover:text-blue-800">
                            <span class="iconify text-xl" data-icon="mdi:weibo"></span>
                        </a>
                        <a href="#" class="text-gray-500 hover:text-blue-800">
                            <span class="iconify text-xl" data-icon="mdi:qq"></span>
                        </a>
                    </div>
                </div>
                <div>
                    <h3 class="font-medium text-gray-800 mb-4">快速链接</h3>
                    <ul class="space-y-2">
                        <li><a href="失物招领平台_失物页面.html" class="text-gray-600 hover:text-blue-800 text-sm">失物信息</a></li>
                        <li><a href="失物招领平台_招领页面.html" class="text-gray-600 hover:text-blue-800 text-sm">招领信息</a></li>
                        <li><a href="失物招领平台_发布信息页面.html" class="text-gray-600 hover:text-blue-800 text-sm">发布信息</a></li>
                        <li><a href="失物招领平台_私信页面.html" class="text-gray-600 hover:text-blue-800 text-sm">私信中心</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-medium text-gray-800 mb-4">帮助中心</h3>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-600 hover:text-blue-800 text-sm">使用指南</a></li>
                        <li><a href="#" class="text-gray-600 hover:text-blue-800 text-sm">常见问题</a></li>
                        <li><a href="#" class="text-gray-600 hover:text-blue-800 text-sm">平台规则</a></li>
                        <li><a href="#" class="text-gray-600 hover:text-blue-800 text-sm">关于我们</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-medium text-gray-800 mb-4">联系我们</h3>
                    <ul class="space-y-2">
                        <li class="flex items-center text-gray-600 text-sm">
                            <span class="iconify mr-2" data-icon="mdi:map-marker"></span>
                            <span>中国·某某大学学生活动中心</span>
                        </li>
                        <li class="flex items-center text-gray-600 text-sm">
                            <span class="iconify mr-2" data-icon="mdi:phone"></span>
                            <span>010-12345678</span>
                        </li>
                        <li class="flex items-center text-gray-600 text-sm">
                            <span class="iconify mr-2" data-icon="mdi:email"></span>
                            <span>contact@shiwutong.com</span>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="border-t border-gray-200 mt-8 pt-8 text-center text-gray-500 text-sm">
                <p>© 2024 拾物通 - 让每一件物品都能回家 版权所有</p>
            </div>
        </div>
    </footer>

    <!-- 交互脚本 -->
    <script>
        // 从URL参数获取物品ID和类型
        function getQueryParams() {
            const params = {};
            window.location.search.substring(1).split('&').forEach(param => {
                const [key, value] = param.split('=');
                params[decodeURIComponent(key)] = decodeURIComponent(value || '');
            });
            return params;
        }

        // 用于处理API失败的回退模拟数据
        const fallbackMockItems = {
            lost: {
                '1': {
                    id: '1',
                    name: '银色笔记本电脑',
                    title: '银色笔记本电脑',
                    description: '在图书馆3楼自习室丢失，联想小新系列，银色外壳，有轻微划痕。电脑贴有星空贴纸，内有重要的学习资料和毕业论文。请捡到的同学联系我，必有重谢！',
                    category: '电子设备',
                    location: '图书馆3楼自习室A区靠窗座位',
                    time: '2024-01-15 14:30-16:00',
                    date: '2024-01-15',
                    features: ['银色联想小新系列笔记本电脑', '外壳有轻微划痕', '贴有星空贴纸', '电脑包为黑色双肩包'],
                    publishDate: '2024-01-15',
                    publisher: {
                        name: '李同学',
                        info: '经济学院 · 2022级'
                    },
                    publisherName: '李同学',
                    images: [
                        'https://modao.cc/ai/uploads/ai_pics/30/302277/aigp_1758618096.jpeg',
                        'https://modao.cc/ai/uploads/ai_pics/30/302277/aigp_1758618097.jpeg',
                        'https://modao.cc/ai/uploads/ai_pics/30/302277/aigp_1758618098.jpeg'
                    ],
                    imageUrl: 'https://modao.cc/ai/uploads/ai_pics/30/302277/aigp_1758618096.jpeg'
                },
                '2': {
                    id: '2',
                    name: '黑色钱包',
                    title: '黑色钱包',
                    description: '在食堂二楼丢失，内含身份证、银行卡和少量现金。请拾到者联系，必有重谢。',
                    category: '包袋箱包',
                    location: '食堂二楼',
                    time: '2024-01-14 12:00-13:30',
                    date: '2024-01-14',
                    features: ['黑色皮质钱包', '有品牌LOGO', '内部有学生证'],
                    publishDate: '2024-01-14',
                    publisher: {
                        name: '王同学',
                        info: '计算机学院 · 2021级'
                    },
                    publisherName: '王同学',
                    images: [
                        'https://modao.cc/ai/uploads/ai_pics/30/302277/aigp_1758618096.jpeg',
                        'https://modao.cc/ai/uploads/ai_pics/30/302277/aigp_1758618097.jpeg'
                    ],
                    imageUrl: 'https://modao.cc/ai/uploads/ai_pics/30/302277/aigp_1758618096.jpeg'
                }
            },
            found: {
                '1': {
                    id: '1',
                    name: '校园卡（李**）',
                    title: '校园卡（李**）',
                    description: '在图书馆一楼大厅捡到一张校园卡，失主姓刘，计算机学院的同学。请尽快联系认领。',
                    category: '证件卡类',
                    location: '图书馆一楼大厅',
                    time: '2024-01-16 15:30',
                    date: '2024-01-16',
                    features: ['红色校园卡套', '卡上姓名：李**', '计算机学院标识'],
                    publishDate: '2024-01-16',
                    publisher: {
                        name: '张同学',
                        info: '文学院 · 2022级'
                    },
                    publisherName: '张同学',
                    images: [
                        'https://modao.cc/ai/uploads/ai_pics/30/302277/aigp_1758618100.jpeg',
                        'https://modao.cc/ai/uploads/ai_pics/30/302277/aigp_1758618101.jpeg'
                    ],
                    imageUrl: 'https://modao.cc/ai/uploads/ai_pics/30/302277/aigp_1758618100.jpeg'
                }
            }
        };
        
        // 从后端API获取物品详情
        async function fetchItemDetails(itemId, itemType) {
            try {
                // 调用后端API获取详情数据，使用完整URL确保能够连接到后端服务器
                const apiUrl = `http://localhost:3000/api/${itemType}-items/${itemId}`;
                console.log('请求API:', apiUrl);
                const response = await fetch(apiUrl);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const item = await response.json();
                console.log('获取物品详情成功:', item);
                return item;
            } catch (error) {
                console.error('获取物品详情失败:', error);
                // 从模拟数据中获取回退数据
                const items = fallbackMockItems[itemType] || {};
                return items[itemId] || null;
            }
        }

        // 显示加载状态
        function showLoading() {
            const mainContent = document.querySelector('main');
            const loadingDiv = document.createElement('div');
            loadingDiv.id = 'loadingIndicator';
            loadingDiv.className = 'fixed inset-0 flex items-center justify-center bg-white bg-opacity-80 z-50';
            loadingDiv.innerHTML = `
                <div class="text-center">
                    <span class="iconify text-6xl text-blue-800 animate-pulse" data-icon="mdi:loading"></span>
                    <p class="mt-4 text-lg">加载中...</p>
                </div>
            `;
            document.body.appendChild(loadingDiv);
        }

        // 隐藏加载状态
        function hideLoading() {
            const loadingDiv = document.getElementById('loadingIndicator');
            if (loadingDiv) {
                document.body.removeChild(loadingDiv);
            }
        }

        // 显示错误信息
        function showError(message) {
            const mainContent = document.querySelector('main');
            mainContent.innerHTML = `
                <div class="text-center py-12">
                    <span class="iconify text-6xl text-red-500" data-icon="mdi:alert-circle"></span>
                    <p class="mt-4 text-xl text-gray-700">${message}</p>
                    <button id="retryButton" class="mt-6 btn-primary">重新加载</button>
                </div>
            `;
            document.getElementById('retryButton').addEventListener('click', loadItemDetails);
        }

        // 标准化API返回的数据结构
        function normalizeItemData(item, itemType) {
            // 确保数据结构一致，处理可能的字段差异
            // 从API返回的数据中提取字段，适应后端返回的格式
            const responseData = item.data || item; // 处理API返回的嵌套结构
            
            // 格式化时间字段
            const timeField = itemType === 'lost' ? 'lost_time' : 'found_time';
            const formattedTime = responseData[timeField] ? 
                new Date(responseData[timeField]).toLocaleString('zh-CN', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                }).replace(/\//g, '-') : '未知时间';
                
            // 格式化发布日期
            const publishDate = responseData.publish_date ? 
                new Date(responseData.publish_date).toLocaleDateString('zh-CN', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit'
                }).replace(/\//g, '-') : '未知日期';
            
            // 生成特征列表
            const generateFeatures = () => {
                const features = [];
                if (responseData.category) features.push(responseData.category);
                if (responseData.location) features.push(`地点：${responseData.location}`);
                if (formattedTime) features.push(`时间：${formattedTime}`);
                if (features.length === 0) features.push(responseData.description || '无特征描述');
                return features;
            };
            
            return {
                id: responseData.id,
                title: responseData.title || responseData.name || '未命名物品',
                description: responseData.description || '暂无描述',
                category: responseData.category || '其他',
                location: responseData.location || '未知地点',
                time: formattedTime,
                features: generateFeatures(),
                publishDate: publishDate,
                publisher: {
                    name: responseData.user?.username || responseData.publisher_name || '匿名用户',
                    info: responseData.user?.college || `${responseData.user?.department || '未知院系'} · 未知年级`
                },
                publisherName: responseData.user?.username || responseData.publisher_name || '匿名用户',
                images: responseData.images || (responseData.image_url ? [responseData.image_url] : ['/images/placeholder.jpg'])
            };
        }

        // 根据参数加载不同的物品信息
        async function loadItemDetails() {
            // 显示加载状态
            showLoading();
            
            try {
                const params = getQueryParams();
                const itemId = params.id || '1';
                const itemType = params.type || 'lost'; // 'lost' 或 'found'
                
                console.log('加载详情页面，参数:', { itemId, itemType });
                
                // 验证物品类型
                if (!['lost', 'found'].includes(itemType)) {
                    throw new Error('无效的物品类型');
                }
                
                // 从API获取物品详情（同步调用）
                const item = await fetchItemDetails(itemId, itemType);
                
                if (!item) {
                    throw new Error('未找到该物品信息');
                }
                
                // 标准化数据结构
                const normalizedItem = normalizeItemData(item, itemType);
                console.log('标准化后的物品数据:', normalizedItem);
                
                // 检查是否有必要的字段
                if (!normalizedItem.title || !normalizedItem.description) {
                    console.warn('数据缺少必要字段，使用模拟数据补充');
                    // 尝试使用模拟数据补充
                    const mockItem = fallbackMockItems[itemType]?.[itemId];
                    if (mockItem) {
                        // 合并API数据和模拟数据
                        Object.assign(normalizedItem, {
                            title: normalizedItem.title || mockItem.title,
                            description: normalizedItem.description || mockItem.description,
                            features: normalizedItem.features.length > 0 ? normalizedItem.features : mockItem.features
                        });
                    }
                }
                
                // 更新页面内容
                document.getElementById('itemTitle').textContent = normalizedItem.title;
                document.getElementById('itemDescription').textContent = normalizedItem.description;
                document.getElementById('itemCategory').textContent = normalizedItem.category;
                document.getElementById('itemLocation').textContent = normalizedItem.location;
                document.getElementById('itemTime').textContent = normalizedItem.time;
                document.getElementById('publishDate').textContent = `发布于：${normalizedItem.publishDate}`;
                document.getElementById('publisherName').textContent = normalizedItem.publisher.name;
                document.querySelector('#publisherName + p').textContent = normalizedItem.publisher.info;
                
                // 更新特征列表
                const featuresElement = document.getElementById('itemFeatures');
                featuresElement.innerHTML = '<ul class="list-disc pl-5"></ul>';
                const ul = featuresElement.querySelector('ul');
                normalizedItem.features.forEach(feature => {
                    const li = document.createElement('li');
                    li.textContent = feature;
                    ul.appendChild(li);
                });
                
                // 更新图片
                const mainImage = document.getElementById('mainImage');
                if (normalizedItem.images && normalizedItem.images.length > 0) {
                    mainImage.src = normalizedItem.images[0];
                } else {
                    mainImage.src = 'https://modao.cc/ai/uploads/ai_pics/30/302277/aigp_1758618096.jpeg';
                }
                mainImage.alt = normalizedItem.title;
                
                // 更新缩略图
                const gallery = document.querySelector('.image-gallery');
                gallery.innerHTML = '';
                if (normalizedItem.images && normalizedItem.images.length > 0) {
                    normalizedItem.images.forEach((imgSrc, index) => {
                        const img = document.createElement('img');
                        img.src = imgSrc;
                        img.alt = `${normalizedItem.title} ${index + 1}`;
                        img.className = `h-20 object-cover cursor-pointer ${index === 0 ? 'border-2 border-blue-800' : ''}`;
                        img.addEventListener('click', function() {
                            mainImage.src = this.src;
                            gallery.querySelectorAll('img').forEach(i => i.classList.remove('border-2', 'border-blue-800'));
                            this.classList.add('border-2', 'border-blue-800');
                        });
                        gallery.appendChild(img);
                    });
                } else {
                    // 添加默认图片
                    const img = document.createElement('img');
                    img.src = 'https://modao.cc/ai/uploads/ai_pics/30/302277/aigp_1758618096.jpeg';
                    img.alt = normalizedItem.title;
                    img.className = 'h-20 object-cover cursor-pointer border-2 border-blue-800';
                    gallery.appendChild(img);
                }
                
                // 根据类型更新标签和按钮
                const tagElement = document.getElementById('itemTag');
                const contactButton = document.getElementById('contactPublisher');
                
                if (itemType === 'found') {
                    tagElement.innerHTML = '<span class="tag tag-found">招领中</span>';
                    contactButton.innerHTML = '<span class="iconify mr-2" data-icon="mdi:message"></span>联系认领';
                } else {
                    tagElement.innerHTML = '<span class="tag tag-lost">寻找中</span>';
                    contactButton.innerHTML = '<span class="iconify mr-2" data-icon="mdi:message"></span>联系发布者';
                }
                
                console.log('加载物品详情完成:', { itemId, itemType, item: normalizedItem });
                
            } catch (error) {
                console.error('加载物品详情失败:', error);
                // 更友好的错误提示
                let errorMessage;
                if (error.message.includes('未找到')) {
                    errorMessage = '未找到该物品信息，请检查物品ID是否正确';
                } else if (error.message.includes('HTTP error')) {
                    errorMessage = '服务器连接失败，请检查网络或稍后重试';
                } else {
                    errorMessage = error.message || '加载失败，请稍后重试';
                }
                showError(errorMessage);
            } finally {
                // 隐藏加载状态
                hideLoading();
            }
        }

        // 图片切换功能
        function setupImageGallery() {
            const thumbnails = document.querySelectorAll('.image-gallery img');
            const mainImage = document.getElementById('mainImage');
            
            thumbnails.forEach(thumbnail => {
                thumbnail.addEventListener('click', function() {
                    // 更新主图
                    mainImage.src = this.src;
                    
                    // 更新缩略图边框
                    thumbnails.forEach(img => img.classList.remove('border-2', 'border-blue-800'));
                    this.classList.add('border-2', 'border-blue-800');
                });
            });
        }

        // 返回按钮功能
        function setupBackButton() {
            document.getElementById('backButton').addEventListener('click', function() {
                const params = getQueryParams();
                const itemType = params.type || 'lost'; // 默认返回失物页面
                
                // 根据物品类型跳转到对应的列表页面
                if (itemType === 'found') {
                    window.location.href = '失物招领平台_招领页面.html';
                } else {
                    window.location.href = '失物招领平台_失物页面.html';
                }
            });
        }

        // 联系发布者功能
        function setupContactButton() {
            document.getElementById('contactPublisher').addEventListener('click', function() {
                const params = getQueryParams();
                const publisherName = document.getElementById('publisherName').textContent;
                // 跳转到私信页面并传递发布者信息
                window.location.href = `失物招领平台_私信页面.html?recipient=${encodeURIComponent(publisherName)}`;
            });
        }



        // 初始化页面
        document.addEventListener('DOMContentLoaded', init);
        
        // 主初始化函数
        async function init() {
            // 加载物品详情
            await loadItemDetails();
            
            // 设置返回按钮事件
            setupBackButton();
            
            // 设置联系按钮事件
            setupContactButton();
        }
    </script>
</body>
</html>